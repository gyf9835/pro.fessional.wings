#!/bin/bash
THIS_VERSION=2022-01-22
GIT_DIR="../../"

###
if [[ "$1" != "" ]]; then
    GIT_DIR=$1
fi

echo -e "\033[37;42;1mScript-Version $THIS_VERSION \033[0m"

cd "$GIT_DIR" || exit
GIT_DIR=$(realpash -s "$GIT_DIR")

echo -e "\033[37;42;1m ==== Compile $GIT_DIR ==== \033[0m"
mvn -U clean compile -Dmaven.test.skip=true

_git_log=git-log.txt
_res_log=git-log.tmp
echo '#Generated by Wings Build Script' >$_git_log
git branch -v >>$_git_log
git log --pretty=format:'%h - %an, %ad : %s' --graph -10 >>$_git_log
find . -type d -name 'classes' | grep '/target/' | while read -r res; do
    echo "$res" >>$_res_log
    cp $_git_log "$res"/
done

echo -e "\033[37;42;1m ==== Package $GIT_DIR ==== \033[0m"
mvn package

echo -e "\033[37;42;1m ==== GitLogs $GIT_DIR ==== \033[0m"
cat "$_git_log"
echo
echo -e "\033[32m ==== git-log into ==== \033[0m"
cat "$_res_log"
echo -e "\033[32m ==== git status ==== \033[0m"
rm -f "$_git_log" "$_res_log"
git status
